<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style type="text/css">
/* CSS代码 */
</style>
<script src="../jQuery/jQuery-2.2.0.js"></script>
<script src="../jQuery/jQuery-2.2.0.min.js"></script>
<script src="../jQuery/jquery-2.2.3.min.js"></script>
</head>

<body>
<div style="padding: 250px 250px 1250px 650px"><img id="zhang" alt="请扫码" src="">
<div id="start" style="padding-left:80px;color: red;font-weight:bold;">请扫描付钱</div></div>
<div id="kkk"></div>

</body>
<script type="text/javascript">
$(function(){
	allpay();
})
function allpay(){
	var url="index/alipay/test"
    $.post(url,function(data){
    	debugger;
    	$("#zhang").attr("src",data.url)
    	$("#kkk").html(data.orderId)
    	url="/index/zhangbing/"+data.orderId;
    	$.ajax(url,function(){
    		debugger;
    	})
    	socket = new WebSocket("ws://localhost:8080/websocket/"+data.orderId);
    	//打开事件
    	socket.onopen = function(){
    		
    	}
    	//获取消息
    	socket.onmessage=function(msg){
    		debugger;
    		
    		if(msg.data=="支付成功"){
    			$("#start").empty();
    			$("#start").html(msg.data)
    			var t=3;//设定跳转的时间
    			　　setInterval(function(){
    				$("#kkk").html("支付成功跳转页面")　
    				location="http://localhost:8993/index/html"
    			　　} ,1000); //启动1秒定时
    			　　　　　 //#设定跳转的链接地址
    			　　　
    		}
    		
    	}
    	//关闭
    	socket.onclose = function() {
    		console.log("Socket已关闭");
    		$("#close").val("Socket已关闭")
    		};
    	
    })
}

if(typeof(WebSocket) == "undefined") {
	console.log("您的浏览器不支持WebSocket");
}else{
	console.log("您的浏览器支持WebSocket");
}
</script>
</html>